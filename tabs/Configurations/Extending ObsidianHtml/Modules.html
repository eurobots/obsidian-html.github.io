<!DOCTYPE html>

<html lang="en">

        <head>
                <!-- Page information -->
                <meta charset="UTF-8" />
                <meta name="node_id" content="modules">
                <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                <link rel="shortcut icon" href="/tabs/favicon.ico" />

                <!-- Set title -->
                <title>ObsidianHtml/Tabs-Mode</title>

                <!-- Includes -->
                
<script src="/tabs/obs.html/static/obsidian_core.js"></script>
<script src="/tabs/obs.html/static/encoding.js"></script>
<link rel="stylesheet" href="/tabs/obs.html/static/master.css" />
<script src="/tabs/obs.html/static/mermaid.9.0.1.min.js"></script>
<script>
  MathJax = {
    loader: {
      load: [
        '[tex]/action',
        'output/chtml',
        '[tex]/centernot'
      ]
    },
    tex: {
      inlineMath: [ ["\\(","\\)"] ],
      displayMath: [ ["\\[","\\]"] ],
      processEscapes: true,
      processEnvironments: true,
      packages: {'[+]': ['centernot']}
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<script src="/tabs/obs.html/static/flexsearch.bundle.js"></script>
<script src="/tabs/obs.html/static/pako.js"></script>
<script src="/tabs/obs.html/static/search.js"></script>
<script src="/tabs/obs.html/static/dirtree.js"></script>


                <!-- Onload tweaks -->
                <script>
                        const CURRENT_NODE = 'modules';
                        const PAGE_DEPTH = 2;
                </script>
        </head>

<body class="theme-obs-light">
        <div id="antiflash" style="display: none;"></div>
        <script>
                document.getElementById('antiflash').style.display = 'block';
        </script>
        <div id="search-master-div">
    <div id="search-slab" king_ramses="return the slaaab">
            <div id="search-controls">
                    <input id="search_string" placeholder="Type to search notes" type="text" />
                    <div class="tooltip" style="display: none;">
                        <input type="checkbox" id="hard_search" name="hard" />
                        <span class="tooltiptext">Hard search (require exact match)</span>
                    </div>
                    <div id="search-results-box">
                        <div id="search-results"></div>
                    </div>
                    <div id="search-instructions">
                        <div class="prompt-instruction">
                                <b>esc</b> to dismiss
                        </div>
                    </div>
            </div>
    </div>
</div>

<script>
    document.getElementById("search-master-div").addEventListener('click', e => {
            if(e.target !== e.currentTarget){
                    return
            }
            toggle_id('search-master-div');
    })
    document.getElementById("search_string").addEventListener("input", function(event) {
            setTimeout( () =>run_search('search_string', 'hard_search'), 100 );
    }); 
    document.getElementById("hard_search").addEventListener("click", function(event) {
            setTimeout( () =>run_search('search_string', 'hard_search'), 100 );
    });

    window.addEventListener('keydown', e => {
        if((e.key=='Escape'||e.key=='Esc'||e.keyCode==27)){
            toggle_id('search-master-div');
            return false;
        } 
    }, true);

    function click_list_link(element){
        element.parentElement.getElementsByTagName('a')[0].click()
    }
</script>
        <div id="page_holder" class="flex_col">
                <div id="header" class="header" style="position:fixed">
                        <div id="header_flex" class="flex_row">
                                <a href="/tabs/index.html" id="homelink" title="Clear screen and go to homepage">ObsidianHtml/Tabs-Mode</a>
                                <div class="navbar-button" onclick="toggle_menu()">
                                        ≡
                                </div>
                                <div id="navbar" class="navbar">
                                        <a class="navbar-link" href="/tabs/index.html" title="Home">Home</a>
<a class="navbar-link" href="/tabs/General Information/About ObsidianHtml.html" title="About">About</a>
<a class="navbar-link" href="/tabs/Instructions/Quickstart.html" title="Quickstart">Quickstart</a>
<a class="navbar-link" href="/tabs/Configurations/Features/Features.html" title="Features">Features</a>
<a class="navbar-link" href="/tabs/Configurations/Configuration Options.html" title="Configurations">Configurations</a>
<a class="navbar-link" href="/tabs/Configurations/Styling/Styling.html" title="Styling">Styling</a>
<a class="navbar-link" href="/tabs/Configurations/Modes/Modes.html" title="Modes">Modes</a>
<a class="navbar-link" href="/tabs/News.html" title="News">News</a>
                                        <div class="icon-tray">
                                                <div id="theme-button" class="theme-button requires_js" title="Change theme" onclick="toggle_theme_popup(this)">
    T
</div>
<script>
    function toggle_theme_popup(el){
        // make theme button show that it's active by adding the .active class
        toggle(el);

        // show the theme selector
        toggle_id('theme-popup')

        let h2 = document.getElementById('header2')
        if (h2){
            let pu = document.getElementById('header2').getElementsByClassName('popup')[0];
            toggle(pu);
        }
    }

    function disable_theme_popup(){
        disable_id('theme-button');

        // show the theme selector
        disable_id('theme-popup')

        let h2 = document.getElementById('header2')
        if (h2){
            let pu = document.getElementById('header2').getElementsByClassName('popup')[0];
            disable(pu);
        }
    }
</script>
                                                        <div onclick="openSearch()" class="theme-button requires_js">
            <img src = "/tabs/obs.html/static/search.svg" alt="Search notes" title="Search notes" style="margin: 4px;"/>
        </div>
        <script>
            function openSearch(){
                // toggle search popup and continue with extra code if it is enabled this time
                if (toggle_id('search-master-div')){
                    // get input field and temporarily disable it
                    let ss = document.getElementById('search_string');
                    ss.value = 'Seach data initializing...';
                    ss.readOnly = true; 

                    // load search data if not yet done so
                    setTimeout(function(){
                        LoadSearchData()

                        // clear input and put focus on it so that we can start typing immediately
                        ss.value = '';
                        ss.readOnly = false; 
                        ss.focus()
                        ss.select()
                    }, 100);
                }
            }
        </script>
                                                        <div class="graph_header_div requires_js">
            <a id="graph_link" class="system-link" href="/tabs/obs.html/graph/index.html?node=modules" title="Open fullpage Graph">
                    <img class="graph_header_div_svg" src = "/tabs/obs.html/static/graph.svg" alt="Open fullpage Graph" style="margin: 2px; width: 17px;"/>
            </a>
        </div>
                                                        <div >
            <a id="dirtree_link" class="system-link" href="/tabs/obs.html/dir_index.html" title="View directory tree">
                    <img src = "/tabs/obs.html/static/dirtree.svg" style="width: 12px; padding: 4px;" alt="Directory tree link"/>
            </a>
        </div>
                                                <div>
    <a href="/tabs/obs.html/tags/index.html" title="Open tag view">
            <img src = "/tabs/obs.html/static/hashtag.svg" alt="RSS Feed link" style="width: 24px; margin-left: -2px; margin-top: -2px;"/>
    </a>
</div>
                                                        <div>
            <a id="rss_link" class="system-link" href="/tabs/obs.html/rss/feed.xml" title="RSS Feed link">
                    <img src = "/tabs/obs.html/static/rss.svg" alt="RSS Feed link"/>
            </a>
        </div>
                                        </div>
                                </div>
                        </div>
                        <div class="popup" id="theme-popup">
    <label for="cars">Theme </label>

    <select name="theme" id="theme" onchange="set_theme(this.value)">
      <option value="light">light</option>
      <option value="obs-light" selected="selected">obsidian-light</option>
      <option value="obs-dark">obsidian-dark</option>
    </select> 
</div>
                </div>
                <div id="header2" class="header">
                        <div id="header_flex2" class="flex_row">
                                <a href="/tabs/index.html" id="homelink" title="Clear screen and go to homepage">ObsidianHtml/Tabs-Mode</a>
                                <div class="navbar-button" onclick="toggle_menu()">
                                        ≡
                                </div>
                                <div id="navbar2" class="navbar">
                                        <a class="navbar-link" href="/tabs/index.html" title="Home">Home</a>
<a class="navbar-link" href="/tabs/General Information/About ObsidianHtml.html" title="About">About</a>
<a class="navbar-link" href="/tabs/Instructions/Quickstart.html" title="Quickstart">Quickstart</a>
<a class="navbar-link" href="/tabs/Configurations/Features/Features.html" title="Features">Features</a>
<a class="navbar-link" href="/tabs/Configurations/Configuration Options.html" title="Configurations">Configurations</a>
<a class="navbar-link" href="/tabs/Configurations/Styling/Styling.html" title="Styling">Styling</a>
<a class="navbar-link" href="/tabs/Configurations/Modes/Modes.html" title="Modes">Modes</a>
<a class="navbar-link" href="/tabs/News.html" title="News">News</a>
                                        <div class="icon-tray">
                                                <div id="theme-button" class="theme-button requires_js" title="Change theme" onclick="toggle_theme_popup(this)">
    T
</div>
<script>
    function toggle_theme_popup(el){
        // make theme button show that it's active by adding the .active class
        toggle(el);

        // show the theme selector
        toggle_id('theme-popup')

        let h2 = document.getElementById('header2')
        if (h2){
            let pu = document.getElementById('header2').getElementsByClassName('popup')[0];
            toggle(pu);
        }
    }

    function disable_theme_popup(){
        disable_id('theme-button');

        // show the theme selector
        disable_id('theme-popup')

        let h2 = document.getElementById('header2')
        if (h2){
            let pu = document.getElementById('header2').getElementsByClassName('popup')[0];
            disable(pu);
        }
    }
</script>
                                                        <div onclick="openSearch()" class="theme-button requires_js">
            <img src = "/tabs/obs.html/static/search.svg" alt="Search notes" title="Search notes" style="margin: 4px;"/>
        </div>
        <script>
            function openSearch(){
                // toggle search popup and continue with extra code if it is enabled this time
                if (toggle_id('search-master-div')){
                    // get input field and temporarily disable it
                    let ss = document.getElementById('search_string');
                    ss.value = 'Seach data initializing...';
                    ss.readOnly = true; 

                    // load search data if not yet done so
                    setTimeout(function(){
                        LoadSearchData()

                        // clear input and put focus on it so that we can start typing immediately
                        ss.value = '';
                        ss.readOnly = false; 
                        ss.focus()
                        ss.select()
                    }, 100);
                }
            }
        </script>
                                                        <div class="graph_header_div requires_js">
            <a id="graph_link" class="system-link" href="/tabs/obs.html/graph/index.html?node=modules" title="Open fullpage Graph">
                    <img class="graph_header_div_svg" src = "/tabs/obs.html/static/graph.svg" alt="Open fullpage Graph" style="margin: 2px; width: 17px;"/>
            </a>
        </div>
                                                        <div >
            <a id="dirtree_link" class="system-link" href="/tabs/obs.html/dir_index.html" title="View directory tree">
                    <img src = "/tabs/obs.html/static/dirtree.svg" style="width: 12px; padding: 4px;" alt="Directory tree link"/>
            </a>
        </div>
                                                <div>
    <a href="/tabs/obs.html/tags/index.html" title="Open tag view">
            <img src = "/tabs/obs.html/static/hashtag.svg" alt="RSS Feed link" style="width: 24px; margin-left: -2px; margin-top: -2px;"/>
    </a>
</div>
                                                        <div>
            <a id="rss_link" class="system-link" href="/tabs/obs.html/rss/feed.xml" title="RSS Feed link">
                    <img src = "/tabs/obs.html/static/rss.svg" alt="RSS Feed link"/>
            </a>
        </div>
                                        </div>
                                </div>
                        </div>
                        <div class="popup" id="theme-popup">
    <label for="cars">Theme </label>

    <select name="theme" id="theme" onchange="set_theme(this.value)">
      <option value="light">light</option>
      <option value="obs-light" selected="selected">obsidian-light</option>
      <option value="obs-dark">obsidian-dark</option>
    </select> 
</div>
                </div>
                <div class="flex_row" id="container_row">
                        <div class="container-wrapper ">
                                <div class="container">
                                
                <div style="width:100%; text-align: right;display: block;margin: 0.5rem;">
                    <div style="flex:1;display: none;"></div>
                    <div class="breadcrumbs" style="flex:1 ;padding: 0.5rem; width: fit-content;display: inline;border-radius: 0.2rem;">
                        <a href="/tabs/" style="color: rgb(var(--normal-text-color));">Home</a> / <span style="color: #666;">Configurations</span> / <span style="color: #666;">Extending ObsidianHtml</span> / <a href="/tabs/Configurations/Extending ObsidianHtml/Modules.html" >Modules</a>
                    </div>
                </div>
<embeddedtitle>Modules</embeddedtitle>
<div class="content"><div class="callout callout-warning active" rasa="1">
<div class="callout-title ">
<div class="callout-title-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="callout-icon"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
</div>
<div class="callout-title-name">Warning
</div>
</div>
<div class="callout-content">
<p>The module system currently is still in <strong>alpha</strong>. Any part of the system might still change until further notice, so keep that in mind before diving into the module system.</p>
</div>
</div>
<h2 id="introduction">Introduction</h2>
<p>Modules are the proposed way <a href="/tabs/Log/Moving%20to%20a%20Module%20system.html">to keep the complexity of ever increasing amounts of features in check</a>. It is my intent to rewrite every chunk of functionality as a module, which will have a clearly defined function, interface, input and output, and thus will be able to be swapped out by a different module that provides the same output but that produces it in a different way.   </p>
<p>Built-in modules will also be required to include testing functions.   </p>
<h2 id="examples">Examples</h2>
<p>The module system is currently already in use (in the master branch code) for internal functions of ObsidianHtml.   </p>
<p>You can find all the modules, and the code to manage them, in this folder:   </p>
<ul>
<li><a href="https://github.com/obsidian-html/obsidian-html/tree/master/obsidianhtml/modules" class="external-link" class="external-link">https://github.com/obsidian-html/obsidian-html/tree/master/obsidianhtml/modules</a>   </li>
</ul>
<p>The builtin folder contains a number of modules that are currently used:   </p>
<ul>
<li><a href="https://github.com/obsidian-html/obsidian-html/tree/master/obsidianhtml/modules" class="external-link" class="external-link">https://github.com/obsidian-html/obsidian-html/tree/master/obsidianhtml/modules</a>/builtin   </li>
</ul>
<h2 id="inputs-and-outputs">Inputs and outputs</h2>
<p>All the inputs and outputs will be in the form of files. The default format should be pretty printed json, to be able to interoperate with different languages.   </p>
<p>One of the first modules to be written will take the given path to the user config, merge it with the default config, and write the merged config as a pretty printed json to either <code>md_output_folder/obs.html/module_data/config.json</code>  or <code>html_output_folder/obs.html/module_data/config.json</code>, depending on whether compile_html is true.   </p>
<h3 id="the-module_data-folder">The module_data folder</h3>
<p>At the beginning, one folder is chosen that will contain all the in- and output files.    </p>
<p><strong>All</strong> the in- and outputs will be written to that one folder. Subfolders are allowed, so one can choose to write to <code>html_output_folder/obs.html/module_data/md/...</code>  and <code>html_output_folder/obs.html/module_data/html/...</code> to discern similar outputs at different phases of the compilation.   </p>
<h2 id="module-structure">Module structure</h2>
<p>A module is any class that extends the <code>obsidianhtml.modules.ObsidianHtmlModule</code> abstract base class, e.g.:   </p>
<div class="lang-python">

<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">obsidianhtml.modules</span> <span class="kn">import</span> <span class="n">ObsidianHtmlModule</span>
<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">ObsidianHtmlModule</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>


</div>

<h2 id="instantiating-of-the-module">Instantiating of the module</h2>
<p>The module will be instantiated by ObsidianHtml with the following input:   </p>
<ul>
<li>The parameter <code>module_data_folder</code> will be passed in, which is the absolute path in the form of a posix string pointing to the folder that was chosen to hold all the in- and outputs for the various modules.   </li>
<li><code>module_name</code> will be passed in. This is the name that you give in the <code>modules</code> list (see below), and can be considered a dog-tag, or alias. Not be confused with <code>ObsidianHtmlModule.module_class_name</code>, which will also be set, and which is the module class's name as defined in the python code (alias for <code>self.__class__.__name__</code>).   </li>
<li><code>persistent</code> (bool) will be passed in, denoting on whether the module object will be stored for later retrieval, or be a one-use instance.   </li>
</ul>
<p>All other input should be read from the module data folder.   </p>
<h3 id="overwriting-the-abstract-base-class-s-__init__-method">Overwriting the abstract base class's <code>__init__</code> method</h3>
<p>You shouldn't, really. Though perhaps there is some very special reason that you need to alter the init method.    </p>
<p>When overwriting this method, be sure to follow the same input scheme, and to call the ABC's init function:   </p>
<div class="lang-python">

<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># my custom code</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">my_custom_attr</span> <span class="o">=</span> <span class="s1">&#39;placeholder&#39;</span>

    <span class="c1"># invoke parent&#39;s init method </span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>


</div>

<h2 id="required-methods">Required methods</h2>
<h3 id="run">run()</h3>
<p>The module is expected to implement at the very least the <code>run()</code> method. This method is supposed to execute the main module code.   </p>
<p>The method is supposed to return nothing. If it does, this is considered a failure. Currently this will just be logged and the program will continue. The provided resources will be marked as failed, thus blocking any modules reliant on it downstream.   </p>
<h2 id="required-properties">Required properties</h2>
<p>Properties that are required are always implemented as <code>@property</code> annotated methods.   </p>
<h3 id="requires">requires()</h3>
<p>Should return a tuple of relative paths (posix strings) of the files that are expected to exist before the module is executed.   </p>
<p>Empty tuples are returned when no input is required.   </p>
<h3 id="provides">provides()</h3>
<p>Should return a tuple of relative paths (posix strings) of the files that are expected to exist before the module is executed.   </p>
<p>Empty tuples are returned when no output is written.   </p>
<h3 id="alters">alters()</h3>
<p>Should return a tuple of strings that denote what resources are altered by the module. Valid values are listed as:   </p>
<ul>
<li><code>"md_output_notes"</code>   <ul>
<li>The module writes in the markdown output folder, altering the content of the notes.   </li>
<li>If the module writes in the md folder, but does not touch the notes themselves, then use <code>"md_misc"</code>   </li>
</ul>
</li>
<li><code>"html_output_notes"</code>   <ul>
<li>The module writes in the html output folder, altering the content of the notes.   </li>
<li>If the module writes in the html folder, but does not touch the notes themselves, then use <code>"html_misc"</code>   </li>
</ul>
</li>
<li><code>"vault_notes"</code>   <ul>
<li>The module writes in the Obsidian vault.   </li>
<li>Modules with this setting are disallowed unless <code>copy_vault_to_tempdir: True</code>   <ul>
<li>This disallow can be overwritten by adding <code>toggles/unsafe: True</code> to the config.yaml   </li>
</ul>
</li>
<li>If the module writes in the vault, but does not touch the notes themselves, then use <code>"vault_misc"</code>   </li>
</ul>
</li>
</ul>
<p>Note that you don't need to specify whether the module writes in the module data folder, as this is apparent from the <code>ObsidianHtmlModule.provides</code> value.   </p>
<h2 id="the-requires-provides-alters-attributes">The requires, provides, alters attributes</h2>
<p>Optionally, the module can list the inputs it expects in the <code>ObsidianHtmlModule.requires</code> tuple object, and list the outputs it provides in the <code>ObsidianHtmlModule.provides</code> tuple object.   </p>
<p>If a module alters an existing file, you can list the file in both the <code>ObsidianHtmlModule.requires</code> and the <code>ObsidianHtmlModule.provides</code>. In fact, whenever a module is called that has an output with the same name as an existing output, the action will be logged as an <code>alter</code> action. E.g.:   </p>
<div class="lang-general">

<div class="codehilite"><pre><span></span><code><span class="n">ModuleA</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="o">[</span><span class="n">config</span><span class="p">.</span><span class="n">json</span><span class="o">]</span>
<span class="n">ModuleB</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">json</span><span class="err">;</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="o">[</span><span class="n">tags</span><span class="p">.</span><span class="n">json</span><span class="p">,</span><span class="w"> </span><span class="n">nodes</span><span class="p">.</span><span class="n">json</span><span class="o">]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">altered</span><span class="w"> </span><span class="o">[</span><span class="n">config</span><span class="p">.</span><span class="n">json</span><span class="o">]</span>
</code></pre></div>


</div>

<p>Such a log will surely prove invaluable for following all the cross-interactions between modules and their input/outputs.   </p>
<h1 id="persistence">Persistence</h1>
<div class="toc">
<ul>
<li><a href="#introduction" class="anchor-link">Introduction</a></li>
<li><a href="#examples" class="anchor-link">Examples</a></li>
<li><a href="#inputs-and-outputs" class="anchor-link">Inputs and outputs</a><ul>
<li><a href="#the-module_data-folder" class="anchor-link">The module_data folder</a></li>
</ul>
</li>
<li><a href="#module-structure" class="anchor-link">Module structure</a></li>
<li><a href="#instantiating-of-the-module" class="anchor-link">Instantiating of the module</a><ul>
<li><a href="#overwriting-the-abstract-base-class-s-__init__-method" class="anchor-link">Overwriting the abstract base class's __init__ method</a></li>
</ul>
</li>
<li><a href="#required-methods" class="anchor-link">Required methods</a><ul>
<li><a href="#run" class="anchor-link">run()</a></li>
</ul>
</li>
<li><a href="#required-properties" class="anchor-link">Required properties</a><ul>
<li><a href="#requires" class="anchor-link">requires()</a></li>
<li><a href="#provides" class="anchor-link">provides()</a></li>
<li><a href="#alters" class="anchor-link">alters()</a></li>
</ul>
</li>
<li><a href="#the-requires-provides-alters-attributes" class="anchor-link">The requires, provides, alters attributes</a></li>
<li><a href="#persistence" class="anchor-link">Persistence</a><ul>
<li><a href="#run-the-same-module-multiple-times" class="anchor-link">Run the same module multiple times</a></li>
</ul>
</li>
<li><a href="#metamodules" class="anchor-link">Metamodules</a></li>
<li><a href="#writing-modules-requirements" class="anchor-link">Writing modules &amp; requirements</a><ul>
<li><a href="#accessing-config-values" class="anchor-link">Accessing config values</a></li>
<li><a href="#reading-and-writing-modfiles" class="anchor-link">Reading and writing modfiles</a></li>
<li><a href="#integration-functions" class="anchor-link">Integration functions</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="run-the-same-module-multiple-times">Run the same module multiple times</h2>
<p>For every item in the <code>module</code> list, a new object will be created, even when the same module is listed multiple times. So the object of the first run is not the same as the object of the second run. This means that you cannot persist state within the object between runs (unless persistence is explicitly set).   </p>
<p>To reuse a module object it has to have <code>persistent: True</code> on the first call, and on the second call. <br />
Take this example:   </p>
<div class="lang-python">

<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">obsidianhtml.modules</span> <span class="kn">import</span> <span class="n">ObsidianHtmlModule</span>
<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">ObsidianHtmlModule</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">requires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">()</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">provides</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_there</span> <span class="o">=</span> <span class="s2">&quot;hi from the second run&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hi from the first run&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_there</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">export_module</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">MyModule</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>


</div>

<p>With    </p>
<div class="lang-yaml">

<div class="codehilite"><pre><span></span><code><span class="nt">modules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/path/to/module/file.py&#39;</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_module</span>
<span class="w">    </span><span class="nt">persistent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/path/to/module/file.py&#39;</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_module</span>
<span class="w">    </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run2</span>
<span class="w">    </span><span class="nt">persistent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</code></pre></div>


</div>

<p>Should give:   </p>
<div class="lang-general">

<div class="codehilite"><pre><span></span><code>hi from the first run
hi from the second run
</code></pre></div>


</div>

<p>If you don't set <code>persistent: True</code> on the first invocation, the module will not be stored, and thus not retrievable in the second run. If you don't set it at the second run, the module system will create a new module object, as that is the default behavior.   </p>
<h1 id="metamodules">Metamodules</h1>
<p>These modules apply to the running of other modules. They do not apply to themselves or other metamodules.   </p>
<p>They can be either run before running a module, think of a checker module; or after a module, for example a logger. For metamodules that should be run before every module, use <code>ObsidianHtmlPreModule</code>, and use <code>ObsidianHtmlPostModule</code> for the other case.   </p>
<p>Metamodules currently work similar to normal modules, except for:   </p>
<ul>
<li><code>ObsidianHtmlPostModule</code> will get the following extra inputs to their run method:   <ul>
<li><code>module</code>: the module object that was just run   </li>
<li><code>result</code>: the value that was returned by the module object's run method   </li>
</ul>
</li>
</ul>
<p>To be implemented:   </p>
<div class="lang-general">

<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`ObsidianHtmlPreModule`</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">following</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">method</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`module`</span><span class="o">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">run</span>
</code></pre></div>


</div>

<h1 id="writing-modules-requirements">Writing modules &amp; requirements</h1>
<h2 id="accessing-config-values">Accessing config values</h2>
<p>You can use <code>self.gc()</code> "get config" method to load a key from the config yaml:   </p>
<div class="lang-python">

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MyCustomModule</span><span class="p">(</span><span class="n">ObsidianHtmlModule</span><span class="p">):</span>
    <span class="c1"># &lt;provides, requires, alters blocks&gt; ...</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gc</span><span class="p">(</span><span class="s2">&quot;toggles/compile_md&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;do stuff&quot;</span><span class="p">)</span>
</code></pre></div>


</div>

<p>Notice here the slashes, which are used to navigate the config tree elements, e.g.:   </p>
<div class="lang-yaml">

<div class="codehilite"><pre><span></span><code><span class="nt">toggles</span><span class="p">:</span>
<span class="w">  </span><span class="nt">compile_md</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>


</div>

<h2 id="reading-and-writing-modfiles">Reading and writing modfiles</h2>
<p>Any file written into the <code>module_data_folder</code> is called a <code>modfile</code>. To read such a file from within your own module, see the following examples:   </p>
<div class="lang-python">

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MyCustomModule</span><span class="p">(</span><span class="n">ObsidianHtmlModule</span><span class="p">):</span>

    <span class="c1"># &lt;provides, requires, alters blocks&gt; ...</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># write simple file to module_data_folder/test.md</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modfile</span><span class="p">(</span><span class="s2">&quot;test.md&quot;</span><span class="p">,</span> <span class="s2">&quot;hi there&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>

        <span class="c1"># convert to json</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modfile</span><span class="p">(</span><span class="s2">&quot;test.json&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;this is&#39;</span><span class="p">,</span> <span class="s1">&#39;a list&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># retrieve contents with .text()</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modfile</span><span class="p">(</span><span class="s2">&quot;test.md&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="c1"># convert contents and retrieve them with .from_json() and .from_yaml()</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modfile</span><span class="p">(</span><span class="s2">&quot;test.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">from_json</span><span class="p">()</span>
</code></pre></div>


</div>

<p>The object returned by <code>self.modfile()</code> will do checking upon accessing the modfiles. If a modfile is read but not listed under <code>self.requires</code>, then this will lead to an error, and similarly for writing a file.   </p>
<div class="callout callout-attention active" rasa="1">
<div class="callout-title ">
<div class="callout-title-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="callout-icon"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
</div>
<div class="callout-title-name">Attention
</div>
</div>
<div class="callout-content">
<p>Any modules that are added in PR's that read/write modfiles with other means than <code>self.modfile().*.write()</code> and <code>self.modfile().read()</code> will be rejected.</p>
</div>
</div>
<h2 id="integration-functions">Integration functions</h2>
<p>The module system is here to replace an older system. <br />
When you write custom modules, you very likely don't need to integrate with the old (<code>pb</code>) system. So you can ignore these functions, as long as you implement them (to satisfy the requirements):   </p>
<div class="lang-python">

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MyCustomModule</span><span class="p">(</span><span class="n">ObsidianHtmlModule</span><span class="p">):</span>
    <span class="c1"># &lt;provides, requires, alters blocks&gt; ...</span>
    <span class="c1"># &lt;run methods&gt; ...</span>
    <span class="k">def</span> <span class="nf">integrate_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pb</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">integrate_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pb</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div>


</div>

<p>The requirement here is pretty clear, you will get an error if you don't implement these.</p></div>
<div class="note-footer">
<div class="backlinks">
<h2>Backlinks</h2>
<ul>
	<li><a class="backlink" href="/tabs/Log/Moving to a Module system.html">moving to a module system</a></li>
</ul>
</div>

<div class="tags">

</div>

</div>
<div class="graph requires_js ">
    <div id="A129771734010303923145239852516678069057{level}" class="graph_div"></div>
    
    <div class="graph-button-row" style="display:flex;">
        <button class="graph_button graph_show_button" id="B129771734010303923145239852516678069057{level}" level="{level}" note_temp_id="129771734010303923145239852516678069057" onclick="window.ObsHtmlGraph.run(this, '129771734010303923145239852516678069057', 'modules');">
            Show Graph
        </button>
        <button class="graph_button graph_type_button" id="C129771734010303923145239852516678069057{level}" style="flex:1" onclick="window.ObsHtmlGraph.switch_graph_type(this);">
            2D
        </button>
    </div>
</div>

<script type="module">
    if (window.ObsHtmlGraph == undefined){
        import('/tabs/obs.html/static/graph.js').then((Module) => {
            window.ObsHtmlGraph = Module;
            window.ObsHtmlGraph.arm_page(document.getElementById('page_holder'))
        })
    }
</script>




                                <!-- end content -->
                                </div>
                        </div>
                </div>
        </div>

        <script src="/tabs/obs.html/static/obsidian_tabs_footer.js" type="text/javascript"></script>

        

</body>
</html>
